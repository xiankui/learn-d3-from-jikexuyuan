<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>learn d3 from jikexuyuan step by step</title>
	<style>

		/* .MyRect {
			fill: steelblue;
		} */

		.MyText {
			fill: white;
			text-anchor: middle;
		}
	</style>
</head>
<body>
	
	<script src='./d3.v4.js'></script>
	<script>
		/**
		 * 交互式操作
		 */

		//画布大小
		var width = 400;
		var height = 400;

		//在 body 里添加一个 SVG 画布   
		var svg = d3.select("body")
		    .append("svg")
		    .attr("width", width)
		    .attr("height", height);

		//画布周边的空白
		 var padding = {left:30, right:30, top:20, bottom:20};

		//定义一个数组
		var dataset = [10, 20, 30, 40, 33, 24, 12, 5];

		//x轴的比例尺
		var xScale = d3.scaleBand()
		    .domain(d3.range(dataset.length))  // [0, 1, ..., length - 1]
		    .range([0, width - padding.left - padding.right]);

		// y轴的比例尺
		var yScale = d3.scaleLinear()
						.domain([0, d3.max(dataset)])
						.range([height - padding.top - padding.bottom, 0])

		var rectPadding = 4;

		// 添加矩形元素
		var rects = svg.selectAll('.MyRect')
			.data(dataset)
			.enter()
			.append('rect')
			.attr('class', 'MyRect')
			.attr('transform', 'translate('+ padding.left + ',' + padding.top +')')
			.attr('x', function (d, i) {
				return xScale(i) + rectPadding/2;
			})
			.attr('y', function (d, i) {
				return yScale(d)
				// var min = yScale.domain()[0];
				// return yScale(min);
			})
			.attr('width', function (d, i) {
				return xScale.bandwidth() - rectPadding;
			})
			.attr('height', function (d, i) {
				return height - padding.top - padding.bottom - yScale(d);
				// return 0;
			})
			// transition rect position and height
			// .transition()
			// .duration(2000)
			// .ease(d3.easeBounce)
			// .delay(function (d, i) {
			// 	return 200 * i;
			// })
			// .attr('y', function (d, i) {
			// 	return yScale(d);
			// })
			// .attr('height', function (d, i) {
			// 	return height - padding.top - padding.bottom - yScale(d);
			// })
			.attr('fill', 'steelblue')
			.on('mouseover', function (d, i) {
				d3.select(this)
					.attr('fill', 'yellow')
			})
			.on('mouseout', function (d, i) {
				d3.select(this)
					.transition()
					.duration(500)
					.attr('fill', 'steelblue')
			})

		// 添加文字元素
		var texts = svg.selectAll('.MyText')
			.data(dataset)
			.enter()
			.append('text')
			.attr('class', 'MyText')
			.attr('transform', 'translate('+ padding.left + ',' + padding.top +')')
			.attr('x', function (d, i) {
				return xScale(i) + rectPadding/2;
			})
			.attr('y', function (d, i) {
				return yScale(d);
				// var min = yScale.domain()[0];
				// return yScale(min);
			})
			.attr('dx', function (d, i) {
				return (xScale.bandwidth() - rectPadding) / 2;
			})
			.attr('dy', function (d, i) {
				return 20;
			})
			.text(function (d) {
				return d;
			})
			// transition y for text position
			// .transition()
			// .duration(2000)
			// .ease(d3.easeBounce)
			// .delay(function (d, i) {
			// 	return 200 * i;
			// })
			// .attr('y', function (d, i) {
			// 	return yScale(d);
			// })

		// 定义x轴坐标
		var xAxis = d3.axisBottom()
			.scale(xScale);

		// 定义y轴坐标
		var yAxis = d3.axisLeft()
			.scale(yScale);

		svg.append('g')
			.attr('transform', 'translate('+ padding.left + ',' + (height - padding.top) +')')
			.call(xAxis);

		svg.append('g')
			.attr('transform', 'translate('+ (padding.left - 2) + ',' + padding.top +')')
			.call(yAxis);


	</script>
</body>
</html>